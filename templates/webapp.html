{% extends "layout_webapp.html" %}

{% block title %}
    webapp
{% endblock %}

{% block body_layout %}
<div class="row" style="margin: 0;">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <div class="column-3 shadow bg-body content" style="flex: 10%; height: 100vh; padding: 2%;">
        <div class="webapp-text">
            <img src="/static/check.png" alt="User" class="img-fluid img-list">My Space
        </div>
        <div class="webapp-text small">
            <ul style="list-style-type: none; padding: 0%;">
                <li><img src="/static/edit.png" alt="Notes" class="img-fluid img-list">Note Manager</li>
                <li><img src="/static/check.png" alt="Tasks" class="img-fluid img-list">Task Manager</li>
                <li><img src="/static/check.png" alt="Search" class="img-fluid img-list">Search</li>
            </ul>
        </div>
        <form action="/logout" >
            <button type="submit">LOGOUT</button>
        </form>

    </div>
    <div class="column-3 content" style="flex: 50%; height: 100vh; padding: 2%; overflow: auto;">
        <form action="/create" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="input-group flex-nowrap shadow-sm">
                <input type="text" class="form-control p-3 bg-body-tertiary rounded webapp-text webapp-create" name="create_item" placeholder="+ Add task or note" aria-label="Item" aria-describedby="addon-wrapping">
            </div>
        </form>
        <div>
            <ul style="list-style-type: none; padding: 0%;" id="webapp_items_list_display">
                {% for item in items %}
                {% if item.item_status == 0 %}
                <li>
                    {% if item.item_type == "note" %}
                        <div class="shadow p-3  webapp-text rounded webapp-item" onclick="itemListener(event)" id="{{ item.id }}">
                            <img src="/static/edit.png" alt="Notes">
                            <div class="webapp-item-title-text" onclick="itemListener(event)">{{ item.title }}</div>
                        </div>
                    {% elif item.item_type == "task" %}
                        <div class="shadow p-3  webapp-text rounded webapp-item" onclick="itemListener(event)" id="{{ item.id }}">
                        {% if item.item_priority == none or item.item_priority == 0 %}
                            <input class="form-check-input webapp-task-p0" type="checkbox" oninput="itemListener(event)">
                        {% elif item.item_priority == 1 %}
                            <input class="form-check-input webapp-task-p1" type="checkbox" oninput="itemListener(event)">
                        {% elif item.item_priority == 2 %}
                            <input class="form-check-input webapp-task-p2" type="checkbox" oninput="itemListener(event)">
                        {% elif item.item_priority == 3 %}
                            <input class="form-check-input webapp-task-p3" type="checkbox" oninput="itemListener(event)">
                        {% else %}
                            <input class="form-check-input webapp-task-p0" type="checkbox" oninput="itemListener(event)">
                        {% endif %}
                            <div class="webapp-item-title-text" onclick="itemListener(event)">{{ item.title }}</div>
                        </div>
                    {% endif %}
                </li>
                {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="column-3 shadow bg-body content edit_item_column" style="flex: 25%; height: 100vh; padding: 2%;">
        <div id="item_header_display">
            <div class="webapp-text small" id="item_check_display"></div>
            <div class="webapp-text small" id="item_deadline_display"></div>
            <div class="webapp-text small" id="item_priority_display"></div>
        </div>
        <div class="webapp-text" >
            <div id="item_title_display"></div>
        </div>
        <div class="webapp-text small" id="item_tags_display"></div>
        <div class="webapp-text" id="item_body_display"></div>
        <div id="item_footer_display">
            <div class="webapp-text small" id="item_list_display"></div>
            <div class="webapp-text small" id="item_type_display"></div>
            <div class="webapp-text small" id="item_delete_display"></div>
        </div>
    </div>
</div> 
<script>
    let itemsData = {{ items|tojson }};
    let tagsData = {{ tags|tojson }};
    let listsData = {{ lists|tojson }};

    async function fetchData() 
    {
        itemsData = await readDatabase("items");
        tagsData = await readDatabase("tags");
        listsData = await readDatabase("lists");
        console.log(itemsData, tagsData, listsData);
        document.dispatchEvent(fetchDataCalled);
    }

    window.addEventListener('resize', adjustTextareaHeight);
    window.addEventListener('load', adjustTextareaHeight);
    document.addEventListener('updateDatabaseCalled', fetchData);
    document.addEventListener('fetchDataCalled', updateItemTitle);
    document.addEventListener('fetchDataCalled', updateType);
    document.addEventListener('fetchDataCalled', updateCheckBox);
</script>
{% endblock %}